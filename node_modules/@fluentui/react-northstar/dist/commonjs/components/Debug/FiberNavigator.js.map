{"version":3,"file":"FiberNavigator.js","names":["_reactIs","require","_getReactFiberFromNode","isDOMNode","e","tagName","nodeType","Node","ELEMENT_NODE","FiberNavigator","__fiber","_proto","prototype","findDebugHookState","node","memoizedState","current","fluentUIDebug","next","isEqual","fiberNav","instance","find","condition","move","fiber","fromFiber","findOwner","owner","findParent","parent","_createClass2","default","key","get","isClassComponent","isFunctionComponent","type","displayName","name","isForwardRef","_this$__fiber$type$re","_this$__fiber$type$re2","return","isHostComponent","stateNode","constructor","_debugOwner","child","memoizedProps","elementType","_this$__fiber$type$pr","isReactComponent","_this$__fiber$type$pr2","_this$__fiber$type","$$typeof","ForwardRef","isDOMComponent","render","setState","exports","fiberNavigator","Object","defineProperty","value","enumerable","writable","configurable","fromDOMNode","domNode","getReactFiberFromNode"],"sources":["components/Debug/FiberNavigator.ts"],"sourcesContent":["import { ForwardRef } from 'react-is';\nimport { getReactFiberFromNode, Fiber } from '../../utils/getReactFiberFromNode';\n\nconst isDOMNode = e => e && typeof e.tagName === 'string' && e.nodeType === Node.ELEMENT_NODE;\n\nexport class FiberNavigator {\n  __fiber: Fiber;\n\n  // TODO: Fibers can become stale.\n  //      The only current fiber is the one found on the DOM node.\n  //      There is no way to start at a React Component fiber, go the DOM node,\n  //      get the current fiber, and find your way back to the React Component fiber.\n  //      Probably need to remove fromFiber and re-implement using only DOM node weak map.\n  static fromFiber = fiber => {\n    if (!fiber) return null;\n\n    const fiberNavigator = new FiberNavigator();\n\n    Object.defineProperty(fiberNavigator, '__fiber', {\n      value: fiber,\n      enumerable: false,\n      writable: false,\n      configurable: false,\n    });\n\n    return fiberNavigator;\n  };\n\n  static fromDOMNode = domNode => {\n    const fiber = getReactFiberFromNode(domNode);\n\n    if (!fiber) return null;\n\n    const fiberNavigator = new FiberNavigator();\n\n    Object.defineProperty(fiberNavigator, '__fiber', {\n      value: fiber,\n      enumerable: false,\n      writable: false,\n      configurable: false,\n    });\n\n    return fiberNavigator;\n  };\n\n  get key() {\n    return this.__fiber.key;\n  }\n\n  get name() {\n    if (this.isClassComponent || this.isFunctionComponent) {\n      return this.__fiber.type.displayName || this.__fiber.type.name;\n    }\n    if (this.isForwardRef) {\n      return (\n        this.__fiber.type.displayName ||\n        this.__fiber.type.name ||\n        this.__fiber.type.return?.displayName ||\n        this.__fiber.type.return?.name\n      );\n    }\n    if (this.isHostComponent) {\n      return this.__fiber.stateNode.constructor.name;\n    }\n    return null;\n  }\n\n  get parent(): FiberNavigator {\n    return FiberNavigator.fromFiber(this.__fiber.return);\n  }\n\n  get owner() {\n    return FiberNavigator.fromFiber(this.__fiber._debugOwner);\n  }\n\n  get domNode() {\n    let fiber = this.__fiber;\n\n    do {\n      if (isDOMNode(fiber.stateNode)) {\n        return fiber.stateNode;\n      }\n      fiber = fiber.child;\n    } while (fiber);\n\n    return null;\n  }\n\n  get instance() {\n    if (this.isClassComponent) {\n      return this.__fiber.stateNode;\n    }\n\n    if (this.isFunctionComponent || this.isForwardRef) {\n      // assumes functional component w/useRef\n      return this.findDebugHookState(this.__fiber.memoizedState);\n    }\n\n    return null;\n  }\n\n  get props() {\n    return this.__fiber.memoizedProps;\n  }\n\n  get state() {\n    return this.__fiber.memoizedState;\n  }\n\n  /**\n   * Hooks state is represented by a recursive structure where:\n   * - `memoizedState` is a current value if applicable\n   * - `next` is next hook in order\n   * @param node - fiber\n   */\n  findDebugHookState(node) {\n    if (node && node.memoizedState && node.memoizedState.current && node.memoizedState.current.fluentUIDebug) {\n      return node.memoizedState.current;\n    }\n\n    if (node === null || node.next === null) {\n      return null;\n    }\n\n    return this.findDebugHookState(node.next);\n  }\n\n  get reactComponent() {\n    return this.isHostComponent ? this.owner.elementType : this.elementType;\n  }\n\n  get elementType() {\n    return this.__fiber.elementType;\n  }\n\n  get fluentUIDebug() {\n    return this.instance && this.instance.fluentUIDebug ? this.instance.fluentUIDebug : null;\n  }\n\n  get jsxString() {\n    return `<${this.name} />`;\n  }\n\n  //\n  // Methods\n  //\n\n  isEqual(fiberNav: FiberNavigator) {\n    // TODO: do equality check on __fiber instead, however, see fromFiber TODO :/\n    return !!fiberNav && fiberNav.instance === this.instance;\n  }\n\n  find(condition, move) {\n    let fiber: FiberNavigator = FiberNavigator.fromFiber(this.__fiber);\n\n    while (fiber) {\n      if (condition(fiber)) {\n        return fiber;\n      }\n      fiber = move(fiber);\n    }\n\n    return null;\n  }\n\n  findOwner(condition) {\n    return this.find(condition, fiber => fiber.owner);\n  }\n\n  findParent(condition) {\n    return this.find(condition, fiber => fiber.parent);\n  }\n\n  //\n  // Component Types\n  //\n\n  get isClassComponent() {\n    // React.Component subclasses have this flag\n    // https://reactjs.org/docs/implementation-notes.html\n    return typeof this.__fiber.type === 'function' && !!this.__fiber.type.prototype?.isReactComponent;\n  }\n\n  get isFunctionComponent() {\n    // React.Component subclasses have this flag\n    // https://reactjs.org/docs/implementation-notes.html\n    return typeof this.__fiber.type === 'function' && !this.__fiber.type.prototype?.isReactComponent;\n  }\n\n  get isForwardRef() {\n    return this.__fiber.type?.$$typeof === ForwardRef;\n  }\n\n  get isHostComponent() {\n    // Host components are platform components (i.e. 'div' on web)\n    // https://github.com/acdlite/react-fiber-architecture#type-and-key\n    return typeof this.__fiber.type === 'string';\n  }\n\n  //\n  // What this fiber component renders\n  //\n\n  get isDOMComponent() {\n    return !!this.__fiber.child && FiberNavigator.fromFiber(this.__fiber.child).isHostComponent;\n  }\n\n  // https://github.com/facebook/react/blob/16.8.6/packages/react-dom/src/test-utils/ReactTestUtils.js#L193\n  get isCompositeComponent() {\n    return this.isDOMComponent ? false : !!this.instance && !!this.instance.render && !!this.instance.setState;\n  }\n}\n"],"mappings":"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"}