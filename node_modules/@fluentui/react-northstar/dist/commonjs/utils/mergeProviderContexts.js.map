{"version":3,"file":"mergeProviderContexts.js","names":["_styles","require","_isBrowser","defaultDocument","document","registeredRenderers","WeakMap","getRenderer","createRenderer","target","actualTarget","isBrowser","has","get","createdRenderer","undefined","set","exports","mergePerformanceOptions","_len","arguments","length","sources","Array","_key","Object","assign","apply","concat","mergeBooleanValues","_len2","_key2","reduce","acc","next","mergeProviderContexts","emptyContext","theme","siteVariables","fontSizes","componentVariables","componentStyles","fontFaces","staticStyles","animations","rtl","disableAnimations","performance","enableSanitizeCssPlugin","process","env","NODE_ENV","enableStylesCaching","enableVariablesCaching","enableBooleanVariablesCaching","telemetry","renderer","_len3","contexts","_key3","mergeThemes","mergedRTL","mergedDisableAnimations"],"sources":["utils/mergeProviderContexts.ts"],"sourcesContent":["import {\n  ProviderContextPrepared,\n  ProviderContextInput,\n  StylesContextPerformance,\n  StylesContextPerformanceInput,\n} from '@fluentui/react-bindings';\nimport { CreateRenderer, Renderer } from '@fluentui/react-northstar-styles-renderer';\nimport { mergeThemes } from '@fluentui/styles';\n\nimport { isBrowser } from './isBrowser';\n\nconst defaultDocument = { document: 'document' };\nconst registeredRenderers = new WeakMap<Document | typeof defaultDocument, Renderer>();\n\nexport const getRenderer = (createRenderer: CreateRenderer, target?: Document): Renderer => {\n  let actualTarget: Document | typeof defaultDocument = target || defaultDocument;\n\n  // A valid comparisons, default renderer will be used\n  if (!isBrowser() || typeof target === 'undefined') {\n    actualTarget = defaultDocument;\n  }\n\n  // SSR logic will be handled by condition above\n  // eslint-disable-next-line no-undef\n  if (isBrowser() && target === document) {\n    actualTarget = defaultDocument;\n  }\n\n  if (registeredRenderers.has(actualTarget)) {\n    return registeredRenderers.get(actualTarget);\n  }\n\n  // To avoid errors related to SSR as `document` may not exist we are using a fake object `defaultDocument`.\n  // When a value matches `defaultDocument` we will pass `undefined` to `createRenderer()` and it should handle it\n  // properly.\n  const createdRenderer = createRenderer(actualTarget === defaultDocument ? undefined : (actualTarget as Document));\n  registeredRenderers.set(actualTarget, createdRenderer);\n\n  return createdRenderer;\n};\n\nexport const mergePerformanceOptions = (\n  target: StylesContextPerformance | StylesContextPerformanceInput,\n  ...sources: StylesContextPerformanceInput[]\n) => {\n  return Object.assign(target, ...sources);\n};\n\nexport const mergeBooleanValues = (target, ...sources) => {\n  return sources.reduce((acc, next) => {\n    return typeof next === 'boolean' ? next : acc;\n  }, target);\n};\n\nexport const mergeProviderContexts = (\n  createRenderer: CreateRenderer,\n  ...contexts: (ProviderContextInput | ProviderContextPrepared)[]\n): ProviderContextPrepared => {\n  const emptyContext: ProviderContextPrepared = {\n    theme: {\n      siteVariables: {\n        fontSizes: {},\n      },\n      componentVariables: {},\n      componentStyles: {},\n      fontFaces: [],\n      staticStyles: [],\n      animations: {},\n    },\n    rtl: false,\n    disableAnimations: false,\n    target: isBrowser() ? document : undefined, // eslint-disable-line no-undef\n    performance: {\n      enableSanitizeCssPlugin: process.env.NODE_ENV !== 'production',\n      enableStylesCaching: true,\n      enableVariablesCaching: true,\n      enableBooleanVariablesCaching: false,\n    },\n    telemetry: undefined,\n    renderer: undefined,\n  };\n\n  return contexts.reduce<ProviderContextPrepared>(\n    (acc: ProviderContextPrepared, next: ProviderContextInput | ProviderContextPrepared) => {\n      if (!next) return acc;\n\n      acc.theme = mergeThemes(acc.theme, next.theme);\n\n      // Latest RTL value wins\n      const mergedRTL = mergeBooleanValues(acc.rtl, next.rtl);\n      if (typeof mergedRTL === 'boolean') {\n        acc.rtl = mergedRTL;\n      }\n\n      // Use provided renderer if it is defined\n      acc.target = next.target || acc.target;\n      acc.renderer = getRenderer(createRenderer, acc.target);\n\n      // Latest disableAnimations value wins\n      const mergedDisableAnimations = mergeBooleanValues(acc.disableAnimations, next.disableAnimations);\n      if (typeof mergedDisableAnimations === 'boolean') {\n        acc.disableAnimations = mergedDisableAnimations;\n      }\n\n      acc.performance = mergePerformanceOptions(acc.performance, next.performance || {});\n\n      acc.telemetry = next.telemetry || acc.telemetry;\n\n      return acc;\n    },\n    emptyContext,\n  );\n};\n"],"mappings":";;;;AAOA,IAAAA,OAAA,GAAAC,OAAA;AAEA,IAAAC,UAAA,GAAAD,OAAA;AAEA,IAAME,eAAe,GAAG;EAAEC,QAAQ,EAAE;AAAW,CAAC;AAChD,IAAMC,mBAAmB,GAAG,IAAIC,OAAO,CAA8C,CAAC;AAE/E,IAAMC,WAAW,GAAG,SAAdA,WAAWA,CAAIC,cAA8B,EAAEC,MAAiB,EAAe;EAC1F,IAAIC,YAA+C,GAAGD,MAAM,IAAIN,eAAe;;EAE/E;EACA,IAAI,CAAC,IAAAQ,oBAAS,EAAC,CAAC,IAAI,OAAOF,MAAM,KAAK,WAAW,EAAE;IACjDC,YAAY,GAAGP,eAAe;EAChC;;EAEA;EACA;EACA,IAAI,IAAAQ,oBAAS,EAAC,CAAC,IAAIF,MAAM,KAAKL,QAAQ,EAAE;IACtCM,YAAY,GAAGP,eAAe;EAChC;EAEA,IAAIE,mBAAmB,CAACO,GAAG,CAACF,YAAY,CAAC,EAAE;IACzC,OAAOL,mBAAmB,CAACQ,GAAG,CAACH,YAAY,CAAC;EAC9C;;EAEA;EACA;EACA;EACA,IAAMI,eAAe,GAAGN,cAAc,CAACE,YAAY,KAAKP,eAAe,GAAGY,SAAS,GAAIL,YAAyB,CAAC;EACjHL,mBAAmB,CAACW,GAAG,CAACN,YAAY,EAAEI,eAAe,CAAC;EAEtD,OAAOA,eAAe;AACxB,CAAC;AAACG,OAAA,CAAAV,WAAA,GAAAA,WAAA;AAEK,IAAMW,uBAAuB,GAAG,SAA1BA,uBAAuBA,CAClCT,MAAgE,EAE7D;EAAA,SAAAU,IAAA,GAAAC,SAAA,CAAAC,MAAA,EADAC,OAAO,OAAAC,KAAA,CAAAJ,IAAA,OAAAA,IAAA,WAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;IAAPF,OAAO,CAAAE,IAAA,QAAAJ,SAAA,CAAAI,IAAA;EAAA;EAEV,OAAOC,MAAM,CAACC,MAAM,CAAAC,KAAA,CAAbF,MAAM,GAAQhB,MAAM,EAAAmB,MAAA,CAAKN,OAAO,EAAC;AAC1C,CAAC;AAACL,OAAA,CAAAC,uBAAA,GAAAA,uBAAA;AAEK,IAAMW,kBAAkB,GAAG,SAArBA,kBAAkBA,CAAIpB,MAAM,EAAiB;EAAA,SAAAqB,KAAA,GAAAV,SAAA,CAAAC,MAAA,EAAZC,OAAO,OAAAC,KAAA,CAAAO,KAAA,OAAAA,KAAA,WAAAC,KAAA,MAAAA,KAAA,GAAAD,KAAA,EAAAC,KAAA;IAAPT,OAAO,CAAAS,KAAA,QAAAX,SAAA,CAAAW,KAAA;EAAA;EACnD,OAAOT,OAAO,CAACU,MAAM,CAAC,UAACC,GAAG,EAAEC,IAAI,EAAK;IACnC,OAAO,OAAOA,IAAI,KAAK,SAAS,GAAGA,IAAI,GAAGD,GAAG;EAC/C,CAAC,EAAExB,MAAM,CAAC;AACZ,CAAC;AAACQ,OAAA,CAAAY,kBAAA,GAAAA,kBAAA;AAEK,IAAMM,qBAAqB,GAAG,SAAxBA,qBAAqBA,CAChC3B,cAA8B,EAEF;EAC5B,IAAM4B,YAAqC,GAAG;IAC5CC,KAAK,EAAE;MACLC,aAAa,EAAE;QACbC,SAAS,EAAE,CAAC;MACd,CAAC;MACDC,kBAAkB,EAAE,CAAC,CAAC;MACtBC,eAAe,EAAE,CAAC,CAAC;MACnBC,SAAS,EAAE,EAAE;MACbC,YAAY,EAAE,EAAE;MAChBC,UAAU,EAAE,CAAC;IACf,CAAC;IACDC,GAAG,EAAE,KAAK;IACVC,iBAAiB,EAAE,KAAK;IACxBrC,MAAM,EAAE,IAAAE,oBAAS,EAAC,CAAC,GAAGP,QAAQ,GAAGW,SAAS;IAAE;IAC5CgC,WAAW,EAAE;MACXC,uBAAuB,EAAEC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY;MAC9DC,mBAAmB,EAAE,IAAI;MACzBC,sBAAsB,EAAE,IAAI;MAC5BC,6BAA6B,EAAE;IACjC,CAAC;IACDC,SAAS,EAAExC,SAAS;IACpByC,QAAQ,EAAEzC;EACZ,CAAC;EAAC,SAAA0C,KAAA,GAAArC,SAAA,CAAAC,MAAA,EAxBCqC,QAAQ,OAAAnC,KAAA,CAAAkC,KAAA,OAAAA,KAAA,WAAAE,KAAA,MAAAA,KAAA,GAAAF,KAAA,EAAAE,KAAA;IAARD,QAAQ,CAAAC,KAAA,QAAAvC,SAAA,CAAAuC,KAAA;EAAA;EA0BX,OAAOD,QAAQ,CAAC1B,MAAM,CACpB,UAACC,GAA4B,EAAEC,IAAoD,EAAK;IACtF,IAAI,CAACA,IAAI,EAAE,OAAOD,GAAG;IAErBA,GAAG,CAACI,KAAK,GAAG,IAAAuB,mBAAW,EAAC3B,GAAG,CAACI,KAAK,EAAEH,IAAI,CAACG,KAAK,CAAC;;IAE9C;IACA,IAAMwB,SAAS,GAAGhC,kBAAkB,CAACI,GAAG,CAACY,GAAG,EAAEX,IAAI,CAACW,GAAG,CAAC;IACvD,IAAI,OAAOgB,SAAS,KAAK,SAAS,EAAE;MAClC5B,GAAG,CAACY,GAAG,GAAGgB,SAAS;IACrB;;IAEA;IACA5B,GAAG,CAACxB,MAAM,GAAGyB,IAAI,CAACzB,MAAM,IAAIwB,GAAG,CAACxB,MAAM;IACtCwB,GAAG,CAACuB,QAAQ,GAAGjD,WAAW,CAACC,cAAc,EAAEyB,GAAG,CAACxB,MAAM,CAAC;;IAEtD;IACA,IAAMqD,uBAAuB,GAAGjC,kBAAkB,CAACI,GAAG,CAACa,iBAAiB,EAAEZ,IAAI,CAACY,iBAAiB,CAAC;IACjG,IAAI,OAAOgB,uBAAuB,KAAK,SAAS,EAAE;MAChD7B,GAAG,CAACa,iBAAiB,GAAGgB,uBAAuB;IACjD;IAEA7B,GAAG,CAACc,WAAW,GAAG7B,uBAAuB,CAACe,GAAG,CAACc,WAAW,EAAEb,IAAI,CAACa,WAAW,IAAI,CAAC,CAAC,CAAC;IAElFd,GAAG,CAACsB,SAAS,GAAGrB,IAAI,CAACqB,SAAS,IAAItB,GAAG,CAACsB,SAAS;IAE/C,OAAOtB,GAAG;EACZ,CAAC,EACDG,YACF,CAAC;AACH,CAAC;AAACnB,OAAA,CAAAkB,qBAAA,GAAAA,qBAAA"}