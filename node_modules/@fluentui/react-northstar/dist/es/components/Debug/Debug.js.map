{"version":3,"file":"Debug.js","names":["getCode","keyboardKey","PropTypes","React","EventListener","isBrowser","isDebugEnabled","DebugPanel","FiberNavigator","DebugRect","INITIAL_STATE","fiberNav","selectedFiberNav","isSelecting","Debug","_React$Component","_inheritsLoose","p","s","_this","call","state","debugReactComponent","r","console","error","_reactInternalFiber","fluentUIDebug","fromFiber","setState","debugDOMNode","domNode","fromDOMNode","findOwner","fiber","handleKeyDown","e","code","Escape","stopSelecting","d","altKey","shiftKey","startSelecting","handleMouseMove","target","handleDOMNodeClick","preventDefault","stopPropagation","Object","assign","selectFiber","changeFiber","positionRight","debugPanelPosition","positionLeft","close","process","env","NODE_ENV","window","openDebugPanel","$r","_proto","prototype","render","mountDocument","props","_this$state","createElement","Fragment","listener","body","type","instance","onActivateDebugSelectorClick","onClose","debugData","position","onPositionLeft","onPositionRight","onFiberChanged","onFiberSelected","Component","defaultProps","document","propTypes","object","isRequired"],"sources":["components/Debug/Debug.tsx"],"sourcesContent":["import { getCode, keyboardKey } from '@fluentui/accessibility';\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport { EventListener } from '@fluentui/react-component-event-listener';\n\nimport { isBrowser } from '../../utils';\nimport { isDebugEnabled } from '@fluentui/styles';\n\nimport { DebugPanel } from './DebugPanel';\nimport { FiberNavigator } from './FiberNavigator';\nimport { DebugRect } from './DebugRect';\n\n/* eslint-disable no-console */\n\nexport type DebugProps = {\n  /** Existing document the popup should add listeners. */\n  mountDocument?: Document;\n};\n\nexport type DebugState = {\n  debugPanelPosition?: 'left' | 'right';\n  fiberNav: FiberNavigator;\n  selectedFiberNav: FiberNavigator;\n  isSelecting: boolean;\n};\n\nconst INITIAL_STATE: DebugState = {\n  fiberNav: null,\n  selectedFiberNav: null,\n  isSelecting: false,\n};\n\nexport class Debug extends React.Component<DebugProps, DebugState> {\n  state = INITIAL_STATE;\n\n  static defaultProps = {\n    // eslint-disable-next-line no-undef\n    mountDocument: isBrowser() ? window.document : null,\n  };\n\n  static propTypes = {\n    mountDocument: PropTypes.object.isRequired,\n  };\n\n  constructor(p, s) {\n    super(p, s);\n    if (process.env.NODE_ENV !== 'production' && isDebugEnabled && isBrowser()) {\n      // eslint-disable-next-line no-undef\n      (window as any).openDebugPanel = () => {\n        // eslint-disable-next-line no-undef\n        this.debugReactComponent((window as any).$r);\n      };\n    }\n  }\n\n  debugReactComponent = r => {\n    if (!r) {\n      console.error(\n        \"No React component selected. Please select a Fluent UI component from the React's Component panel.\",\n      );\n      return;\n    }\n    if (!r._reactInternalFiber) {\n      console.error(\n        'React does not provide data for debugging for this component. Try selecting some Fluent UI component.',\n      );\n      return;\n    }\n    if (!r.fluentUIDebug) {\n      console.error('Not a debuggable component. Try selecting some Fluent UI component.');\n      return;\n    }\n\n    const fiberNav = FiberNavigator.fromFiber(r._reactInternalFiber);\n    this.setState({ fiberNav, isSelecting: false, selectedFiberNav: null });\n  };\n\n  debugDOMNode = domNode => {\n    let fiberNav = FiberNavigator.fromDOMNode(domNode);\n\n    if (!fiberNav) {\n      console.error('No fiber for dom node', domNode);\n      return;\n    }\n\n    fiberNav = fiberNav.findOwner(fiber => fiber.fluentUIDebug);\n\n    if (fiberNav !== this.state.fiberNav) {\n      this.setState({ fiberNav });\n    }\n  };\n\n  handleKeyDown = e => {\n    const code = getCode(e);\n\n    switch (code) {\n      case keyboardKey.Escape:\n        this.stopSelecting();\n        break;\n\n      case keyboardKey.d:\n        if (e.altKey && e.shiftKey) {\n          this.startSelecting();\n        }\n        break;\n    }\n  };\n\n  handleMouseMove = e => {\n    this.debugDOMNode(e.target);\n  };\n\n  handleDOMNodeClick = e => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.setState({ isSelecting: false });\n  };\n\n  startSelecting = () => {\n    const isSelecting = !this.state.isSelecting;\n\n    this.setState({\n      ...(!isSelecting && INITIAL_STATE),\n      isSelecting,\n    });\n  };\n\n  stopSelecting = () => {\n    this.setState(INITIAL_STATE);\n  };\n\n  selectFiber = selectedFiberNav => this.setState({ selectedFiberNav });\n\n  changeFiber = fiberNav => this.setState({ fiberNav });\n\n  positionRight = () => this.setState({ debugPanelPosition: 'right' });\n\n  positionLeft = () => this.setState({ debugPanelPosition: 'left' });\n\n  close = () => this.setState(INITIAL_STATE);\n\n  render() {\n    const { mountDocument } = this.props;\n    const { fiberNav, selectedFiberNav, isSelecting, debugPanelPosition } = this.state;\n\n    if (process.env.NODE_ENV !== 'production' && isDebugEnabled) {\n      return (\n        <>\n          <EventListener listener={this.handleKeyDown} target={mountDocument.body} type=\"keydown\" />\n          {isSelecting && (\n            <EventListener listener={this.handleMouseMove} target={mountDocument.body} type=\"mousemove\" />\n          )}\n          {isSelecting && fiberNav && fiberNav.domNode && (\n            <EventListener listener={this.handleDOMNodeClick} target={fiberNav.domNode} type=\"click\" />\n          )}\n          {isSelecting && fiberNav && <DebugRect fiberNav={fiberNav} />}\n          {selectedFiberNav && <DebugRect fiberNav={selectedFiberNav} />}\n          {!isSelecting && fiberNav && fiberNav.instance && (\n            <DebugPanel\n              fiberNav={fiberNav}\n              onActivateDebugSelectorClick={this.startSelecting}\n              onClose={this.close}\n              // TODO: Integrate CSS in JS Styles for Host Components (DOM nodes)\n              // cssStyles={stylesForNode(domNode)}\n              debugData={fiberNav.fluentUIDebug}\n              position={debugPanelPosition || 'right'}\n              onPositionLeft={this.positionLeft}\n              onPositionRight={this.positionRight}\n              onFiberChanged={this.changeFiber}\n              onFiberSelected={this.selectFiber}\n            />\n          )}\n        </>\n      );\n    }\n\n    return null;\n  }\n}\n"],"mappings":"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"}